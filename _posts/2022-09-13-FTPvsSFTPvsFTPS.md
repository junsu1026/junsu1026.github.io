---
layout: post
title:  "FTPvsSFTPvsFTPS"
date:   2022-09-12T14:25:52-05:00
author: Junsu Noh
categories: Computer
tags:	jekyll welcome
cover:  "/assets/instacode.png"
---

# FTP(20, 21번 포트)

## ftp(file transfer protocol)란?

<aside>
💡 파일 전송 통신 규약으로써 TCP/IP 프로토콜로 서버와 클라이언트 사이의 파일 전송을 하기 위한 프로토콜이다.

</aside>

### http와 다른점

http와의 다른점은 FTP는 자신이 작업하기 원하는 파일을 작업하는 동안은 서버와 계속 연결되어 있습니다.

### 장점

1. FileZilla, WinSCP, Cyberduck 등 FTP를 보다 간편하게 사용할 수 있도록 지원하는 데스크톱 소프트웨어 도구가 있다.
2. 동시에 여러 파일을 전송할 수 있다.(대용량 전송)
3. 연결이 끊긴 경우 전송을 재개할 수 있다.
4. 전송 일정을 예약할 수 있다.

### 단점

1. **보안을 설정할 수 없기 때문에 수많은 보안 취약점들이 존재한다.(**보안프로토콜이 존재하지 않기 때문에 암호화 되지 않는다.) ****

### 2개의 21,20번 포트 사용

> FTP는 다른 프로토콜들과 다르게 포트(port) 번호를 기본 두 개를 사용하도록 제작되었습니다.
> 
1. 제어포트 : 포트번호 21번으로 클라이언트와 서버 사이의 명령, 제어 등을 송수신하는 **제어 포트**입니다.
2. 데이터 포트 : 포트번호 20번으로 클라이언트와 서버 사이의 직접적인 파일 송 수신을 담당하는 **데이터 포트**입니다.

### 2개의 mode 사용

> Active mode가 default 설정
> 
1. **Active mode :** 처음 연결을 시도할 때 21번 포트로 서로 신호를 주어 받고 그 후 데이터 포트를 연결할 때 Active mode는 클라이언트가 서버에게 20번 포트로 연결해달라고 알려주면 서버는 클라이언트의 20번 포트로 연결을 하는 것입니다.
    
    하지만 이러한 동작은 실제로 방화벽으로 인하여 연결이 제대로 이어지지 않는 일이 발생할 때가 있습니다. 그 때문에 존재하는 것이 passive mode
    
2. **Passive mode :** Active mode의 반대로 서버 쪽에서 클라이언트에게 연결할 포트를 알려줍니다.
    
    ![ftp 전달 모드](https://user-images.githubusercontent.com/90672736/189820015-639da04c-7ca1-4748-8aae-f03fef99fca5.png)
    

## 작동방식

서버와 클라이언트가 서로 명령이나 데이터를 주고받을 때 암호화 과정 없이 평문을 주고받습니다.

![https://blog.kakaocdn.net/dn/CzYW9/btqMM5twxLb/Ij1j9J80EGBBkSkSDBSBtK/img.png](https://blog.kakaocdn.net/dn/CzYW9/btqMM5twxLb/Ij1j9J80EGBBkSkSDBSBtK/img.png)

위 그림은 FTP로 서버에 접속하려는 유저 아이디와 패스워드를 서버에 보내어 인증을 받는 장면입니다.

얼핏 보면 인증도 잘 받고 괜찮아 보입니다.

![https://blog.kakaocdn.net/dn/cpEiw8/btqMJFo8Tci/C3lY17Z2uFcLk4wjigL7q1/img.png](https://blog.kakaocdn.net/dn/cpEiw8/btqMJFo8Tci/C3lY17Z2uFcLk4wjigL7q1/img.png)

하지만 위 그림처럼 H라는 해커가 중간에서 가로챈다면 암호화가 하나도 되지 않은 계정 아이디와 패스워드를 확인할 수 있습니다.

FTP 전용 계정이라 괜찮다? 절대 아닙니다.

FTP **주목적이 파일 관리**이기 때문에 파일을 삭제하거나 중요 데이터를 삭제, 다운로드 등 큰 문제로 이어질 수 있습니다.

다행히도 현재는 이러한 문제를 해결하기 위해 보안 프로토콜 등이 많이 존재합니다.

## FTP 명령

**USER, PASS :** 처음 클라이언트와 서버가 연결될 때 이 두 개를 통해 username, password를 보내어 인증을 받습니다.

**CWD** : 작업 디렉터리를 변경합니다.

**CDUP** : 부모 디렉터리로 위치를 변경합니다.

**RMD** : 디렉터리 제거

**MKD** : 디렉터리 생성

## 결론

FTP가 파일을 전송하는 효과적인 방법임에는 틀림없지만 시대에 뒤처진 면이 있고, 오늘날에는 FTP의 기능을 능가하는 서비스형 SFTP 등의 새로운 네트워크 프로토콜도 다양하게 찾아볼 수 있습니다. 

# SFTP(22번 포트)

## sftp란?

<aside>
💡 sftp는 ssh가 확장된 파일 전송 버전입니다. ssh(Secure Shell)는 텔넷의 보안 버전입니다.

```
**즉, FTP의 형태를 가지고 있지만 그 안에 내용물은 SSH를 이용해서 연결을 하는 것이 바로 SFTP입니다. (계정 정보와 접속 포트가 SSH와 같습니다.)**
```

</aside>

> 실제로도 접속은 SSH 접속 프로그램을 이용해서 접속하는 것이 아니라일반적으로 FTP Client 프로그램을 통해 접속을 합니다.
> 

**SFtp 장점**

- 시큐어셸 기반이기 때문에 퍼미션 변경에서 더 강력해지는데, 특히 루트(root) 계정일 때 더욱 그렇다.
- 외부에서도 파일 관리가 편해진다.
- 루트 계정일 경우 서버의 시스템 관리가 더 편리해진다.
- 운영의 대부분의 측면을 엄격하게 정의하는 좋은 표준 배경을 가지고 있다.
- 하나의 연결만 있다. 또한 데이터 연결이 필요 없다.(ftp는 데이터,제어 채널이 따로 있지만 sftp는 데이터,제어 채널이 하나로 되어있다.)
- 클라이언트와 서버와의 연결은 항상 보호된다.
- 디렉터리 목록은 균일하고 기계가 읽을 수 있다.
- 프로토콜에는 권한 및 속성 조작, 파일 잠금 및 기타 기능이 있다.

**SFtp 단점**

- 보안을 위해서 키를 주고받고 암호화 복호화 과정을 거치기 때문에 속도가 느리다.
- 통신은 바이너리이며 사람이 읽을 수 있도록 '있는 그대로' 기록할 수 없다.
- 시큐어셸 키는 관리 및 검증이 더 어렵다.
- 표준은 특정 사항을 선택 사항 또는 권장 사항으로 정의하기 때문에 서로 다른 공급 업체의 서로 다른 소프트웨어 타이틀 간에 특정 호환성 문제가 발생한다.
- 서버 간 복사 및 반복적인 디렉토리 제거 작업 없다.
- 비주얼 컴포넌트 라이브러리(VCL) 및 닷넷(.NET)프레임 워크에서 기본 제공 시큐어셸 및 SFTP 지원이 없다.

# FTPS(990번포트)

## ftps(FTP / SSL)란?

<aside>
💡 FTP 소프트웨어가 안전한 파일 전송을 수행 할 수있는 다양한 방법을 제공하는 데 사용되는 이름입니다. 각 방법은 표준 FTP 프로토콜 아래의 SSL / TLS 계층을 사용하여 제어 및 / 또는 데이터 채널을 암호화합니다.

</aside>

- TLS/SSL을 거쳐서 공개키 암호화 방식을 이용하여 통신 라인을 거쳐가는 21번, 20번 포트를 안전하게 암호화한다(포트는 설정에서 변경가능)
- ftp와 ftps는 http와 https 의 관계와 비슷하다.

## SFTP와 다른점

1) 보안

-둘다 강력한 암호화를 통해 전송하지만 FTPS 는 명령 포트 외에 데이터 포트를 추가적으로 사용해야하므로 이 부분에서는 하나의 포트만 사용하는 SFTP 가 좀 더 낫다고 볼수있다.

(2) 구조

-FTPS 는 두개의 연결(명령전송, 데이터전송)이 필요하므로 포트도 두개 필요.

하지만 SFTP 는 명령, 데이터 전송을 하나의 연결만으로 처리한다. 22번 포트 하나만 필요.

-FTPS 는 vsftp 같은 ftp 프로그램의 설치가 필요하지만 SFTP 는 ssh 프로그램만 있으면 되며 ftp프로그램 설치는 굳이 필요없다.

SFTP 가 좀 더 간단한 구성.

(3) 속도

-FTPS 는 명령, 데이터 각 두개의 연결이 비동기적으로 처리되어 SFTP 보다 빠르긴 한데 그 차이는 크지 않다.
